<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RC_Auto_Scheduling</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #597492; /* æŸ”å’Œç°è‰² */
      color: #ffffff; /* æ–‡å­—é¡è‰²ï¼Œé¿å…å°æ¯”éé«˜ */
    }
    h2 {
      /*text-align: center; */
      text-decoration: underline;
      color: #333;
    }
    .container {
      display: flex;
      flex-direction: column;
      height: 80vh;
    }
    .top {
      display: flex;
      flex: 1;
    }
    .top-left {
      flex: 1;
      padding: 10px;
    }
    .top-name { 
      border: none;      /* ç§»é™¤ div çš„é‚Šæ¡† */
      padding: 10px;     /* è¨­ç½® div çš„å…§éƒ¨é–“è· */
      font-size: 14px;   /* è¨­ç½®å­—é«”å¤§å° */
      display: inline-block;  /* ä½¿ div é¡¯ç¤ºç‚ºå€å¡Šå…ƒç´ ï¼Œå¯ä»¥æ ¹æ“šéœ€è¦èª¿æ•´ç‚º block æˆ– inline */
    }
    #name-table td {
      padding: 10px; /* è¨­ç½®å–®å…ƒæ ¼å…§éƒ¨çš„é–“è· */
      border: none; /* è¨­ç½®å–®å…ƒæ ¼çš„é‚Šæ¡† */
      font-size: 14px; /* è¨­ç½®å­—é«”å¤§å°ï¼Œæ ¹æ“šéœ€è¦èª¿æ•´ */
      text-align: left; /* è¨­ç½®æ–‡å­—å°é½Šæ–¹å¼ç‚ºå·¦ */
    }
    .top-right {
      flex: 1;
      display: flex;
      justify-content: space-between;
      padding: 10px;
    }
    .table-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0 10px;
    }
    .table-group .vertical-text {
      text-align: center;
      margin-bottom: 5px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 10px;
    }
    td, th {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    .hidden {
      display: none;
    }
    .navbar {
      display: flex;
      justify-content: space-between;
      background-color: #333;
      padding: 10px;
      color: white;
    }
    .btn {
      padding: 10px;
      margin: 5px;
      cursor: pointer;
      border: none;
      background-color: #007bff;
      color: white;
      border-radius: 5px;
    }
    .btn:hover {
      background-color: #0056b3;
    }

    #moreContent {
    display: none; /* é è¨­éš±è— */
    max-height: none; /* å…§å®¹é«˜åº¦è‡ªé©æ‡‰ */
    }

  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

</head>
<body>

<div class="navbar" style="overflow-x: auto;">
  <button id="loginBtn" class="btn" onclick="toggleLogin()">ç™»å…¥</button>
  <span id="userStatus" class="hidden"></span> 
  <h1><a href="https://youtu.be/lCesagWgb8s?feature=shared" target="_blank"><i class="fa-brands fa-youtube" style="color: white;"></i></a></h1>
  <h3> <a href="https://github.com/123456dr/auto_scheduling" target="_blank">ç¨‹å¼ç¢¼</a></h3>
  <h1>605_Auto_Scheduling</h1>
</div>
<!--<h2>æœ¬æ¬¡</h2> -->
<div class="container" >
  <div style="overflow-y: auto;">
  <div class="top">
    <!-- å·¦åŠé‚Šè¡¨æ ¼ -->
    <div  id="name" style="display:none;">
      <table id="name-table" >
        <tbody>
          <tr><td>é£¯</td></tr>
          <tr><td>å¤§èœ</td></tr>
          <tr><td>å°èœ</td></tr>
          <tr><td>æ¹¯</td></tr>
          <tr><td>æ´—ç¢—</td></tr>
        </tbody>
      </table>
    </div>
    <div class="top-left">
      <table id="left-table">
        <tbody>
          <tr><td></td><td></td></tr>
          <tr><td></td><td></td></tr>
          <tr><td></td><td></td></tr>
          <tr><td></td><td></td></tr>
          <tr><td></td><td></td></tr>
        </tbody>
      </table>
    </div>
    
    <!-- å³åŠé‚Šè¡¨æ ¼ -->
    <div class="top-right">
      <div class="table-group">
        <div class="vertical-text">æ“¦é¤è»Š&é£²æ°´æ©Ÿ</div>
        <table id="right-table1">
          <tbody>
            <tr><td></td></tr>
            <tr><td></td></tr>
          </tbody>
        </table>
      </div>
      <div class="table-group">
        <div class="vertical-text">æœ¬æ¬¡æ“¦é»‘æ¿äººå“¡</div>
        <table id="right-table2">
          <tbody>
            <tr><td></td></tr>
            <tr><td></td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <br><br>
  <div class="top" style="overflow-x: auto;" >
    èª¿ç­&nbsp;:&nbsp;&nbsp;
    <select id="leaveType" style="height: 46px; width: 100px;">
      <option value="A">æŠ¬é¤äººå“¡</option>
      <option value="B">å€¼æ—¥äººå“¡</option>
    </select>&nbsp;
    <input type="number" id="leaveNumber" placeholder="è¼¸å…¥è«‹å‡è™Ÿç¢¼" style="height: 40px; width: 100px;">
    <input type="number" id="replaceNumber" placeholder="æ›¿ä»£è™Ÿç¢¼(é¸å¡«)" style="height: 40px; width: 110px;">
    &nbsp;&nbsp;<button id="submitButton" style="height: 46px; width: 50px;">é€å‡º</button>
  </div>
  </div>
  <script>
    document.getElementById("leaveType").addEventListener("change", function() {
        let replaceInput = document.getElementById("replaceNumber");
        if (this.value === "B") {
            replaceInput.style.display = "none"; // éš±è—
        } else {
            replaceInput.style.display = "inline-block"; // é¡¯ç¤º
        }
    });

    document.getElementById("submitButton").addEventListener("click", async function() {
      let userResponse = confirm("ç¢ºå®šè¦èª¿æ•´ç­æ¬¡å—ï¼Ÿ");
      if (userResponse) {
          alert("å·²ç¢ºå®šï¼"); 
      } else {
          alert("å·²å–æ¶ˆï¼"); 
          return;
      }


        let leaveType = document.getElementById("leaveType").value;
        let leaveNumber = document.getElementById("leaveNumber").value.trim();
        let replaceNumber = document.getElementById("replaceNumber").value.trim();

        if (!leaveNumber) {
            alert("è«‹è¼¸å…¥è«‹å‡è™Ÿç¢¼");
            return;
        }
 
        let sheetData = await fetchSheetData();
        let validNumbers = leaveType === "A" 
            ? [...sheetData.A, ...sheetData.B]  // Aé¡æª¢æŸ¥ A1~A5 & B1~B5
            : [...sheetData.D, ...sheetData.E]; // Bé¡æª¢æŸ¥ D1~D2 & E1~E2

        if (!validNumbers.includes(leaveNumber)) {
            alert("å¤±æ•—ã€‚è¼¸å…¥çš„è™Ÿç¢¼ç›®å‰æœªè¢«å®‰æ’");
            return;
        }


        if (leaveType === "A") {
          alert("å“ˆå“ˆ ç›®å‰åªåšå¥½å€¼æ—¥ç”Ÿèª¿ç­");return;
        }
        else if (leaveType === "B") {
            let message1 = "rangeduty";
            let numindexx = "0";
            let numindexy = "0";

            // **å°‹æ‰¾ leaveNumber åœ¨è©¦ç®—è¡¨ä¸­çš„ç´¢å¼•**
            for (let i = 0; i < sheetData.D.length; i++) {
                if (sheetData.D[i] == leaveNumber) {
                    numindexx = i + 1; // D1, D2 è½‰æˆç´¢å¼•
                    numindexy = 4; // D æ¬„ç´¢å¼• (å¾ 0 é–‹å§‹ç®—)
                    break;
                }
            }
            for (let i = 0; i < sheetData.E.length; i++) {
                if (sheetData.E[i] == leaveNumber) {
                    numindexx = i + 1;
                    numindexy = 5; // E æ¬„ç´¢å¼•
                    break;
                }
            }

            if (numindexx === "" || numindexy === "") {
                alert("å¤±æ•—ã€‚è¼¸å…¥çš„è™Ÿç¢¼ç›®å‰æœªè¢«å®‰æ’");
                return;
            }

            let url = `https://script.google.com/macros/s/AKfycbwZpsSjxlxsYkt5x2gOO3_59seqIENRJJeWyziQXCp0othCRydJ6emAfleLVGFeb4-S/exec?message1=${encodeURIComponent(message1)}&numindexx=${encodeURIComponent(numindexx)}&numindexy=${encodeURIComponent(numindexy)}&leavenum=${encodeURIComponent(leaveNumber)}`;
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                const data = await response.text(); // å¦‚æœ API æœ‰è¿”å›å…§å®¹
                //console.log("API å›æ‡‰:", data);
                
            } catch (error) {
                console.error("è«‹æ±‚å¤±æ•—:", error);
                //alert("è«‹æ±‚å¤±æ•—ï¼Œè«‹æª¢æŸ¥ API è¨­å®š");
            }

            
            showing(); alert("å·²èª¿ç­");
        }
    });

    /** ğŸš€ **å¾ Google Sheets è®€å–æ•¸æ“š** */
    async function fetchSheetData() {
        const sheetId = "1HWk8s__aXVkSLs4iShYuAdaiI231ze0-GDN52dcNN_A"; 
        const apiKey = "AIzaSyCaPHKS9sBRNf0805GkgeMRgysyQPPuK0k";  
        const range = "A1:J100";  

        const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`; 
        let response = await fetch(url);
        let data = await response.json();
        let values = data.values || [];
        console.log("å¾ Google Sheets ç²å–çš„è³‡æ–™:", data);
        return {
            A: values.slice(0, 5).flat(),  // A1~A5
            B: values.slice(0, 5).map(row => row[1]),  // B1~B5
            D: [values[0][3], values[1][3]],  // D1, D2
            E: [values[0][4], values[1][4]],  // E1, E2
            H: values.slice(1).map(row => row[7]).filter(cell => cell),  // H2~Hæ¬„ç‚ºç©º
            J2: parseInt(values[1][9] || "0", 10),  // J2å€¼ï¼Œç¢ºä¿æ˜¯æ•¸å­—
            Q: values.map(row => row[16]).filter(cell => cell)  // Q1~Qæ¬„ç‚ºç©º
        };
    }
    </script>







  <a href="https://docs.google.com/spreadsheets/d/1HWk8s__aXVkSLs4iShYuAdaiI231ze0-GDN52dcNN_A/edit?usp=sharing" target="_blank">é»æ“Šé€™è£¡æŸ¥çœ‹ Google è©¦ç®—è¡¨</a>


  <!-- æŒ‰éˆ•å€ -->
  <!-- <button class="btn" onclick="fetchData()">é¡¯ç¤ºæ•¸æ“š</button> -->
  <button class="btn" id="showbtn" onclick="showingbtn()">é¡¯ç¤ºæ•¸æ“š</button>
  <button id="schedulebtn" class="btn hidden" onclick="scheduling()">é‡æ–°å®‰æ’äººå“¡</button>

  <hr>
  <button id="morebtn" onclick="toggleContent()">é¡¯ç¤ºæ›´å¤š</button>
  <!-- ä¸‹æ–¹å€å¡Š -->
  <div id="moreContent">
    <h2>ä¸Šæ¬¡</h2>
    <div class="bottom">
      <div class="container">
        <div class="top">
          <!-- å·¦åŠé‚Šè¡¨æ ¼ -->
          <div  id="name1" style="display:none;">
            <table id="name-table" >
              <tbody>
                <tr><td>é£¯</td></tr>
                <tr><td>å¤§èœ</td></tr>
                <tr><td>å°èœ</td></tr>
                <tr><td>æ¹¯</td></tr>
                <tr><td>æ´—ç¢—</td></tr>
              </tbody>
            </table>
          </div>
          <div class="top-left">
            <table id="left-table">
              <tbody>
                <tr><td></td><td></td></tr>
                <tr><td></td><td></td></tr>
                <tr><td></td><td></td></tr>
                <tr><td></td><td></td></tr>
                <tr><td></td><td></td></tr>
              </tbody>
            </table>
          </div>
          
          <!-- å³åŠé‚Šè¡¨æ ¼ -->
          <div class="top-right">
            <div class="table-group">
              <div class="vertical-text">æ“¦é¤è»Š&é£²æ°´æ©Ÿ</div>
              <table id="right-table1">
                <tbody>
                  <tr><td></td></tr>
                  <tr><td></td></tr>
                </tbody>
              </table>
            </div>
            <div class="table-group">
              <div class="vertical-text">ä¸Šæ¬¡æ“¦é»‘æ¿äººå“¡</div>
              <table id="right-table2">
                <tbody>
                  <tr><td></td></tr>
                  <tr><td></td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
    </div>

    <br><br>
    <!--<p>æˆ‘æ˜¯å»£å‘Š(ä¸è¦é»æˆ‘)</p>
    <script type="text/javascript">
      atOptions = {
        'key' : '06cb36d680391c873b7c96a3f5ba0f8a',
        'format' : 'iframe',
        'height' : 250,
        'width' : 300,
        'params' : {}
      };
    </script>
    <script type="text/javascript" src="//www.highperformanceformat.com/06cb36d680391c873b7c96a3f5ba0f8a/invoke.js"></script>
  -->
  </div>
</div>



<script>

function toggleContent() {
    const moreContent = document.getElementById("moreContent");
    const button = document.getElementById("morebtn");

    if (moreContent.style.display === "none" || moreContent.style.display === "") {
        moreContent.style.display = "block"; // é¡¯ç¤ºå…§å®¹
        document.body.style.overflow = "auto"; // ç¢ºä¿é é¢å¯ä»¥æ»¾å‹•
        button.textContent = "é¡¯ç¤ºæ›´å°‘";
    } else {
        moreContent.style.display = "none"; // éš±è—å…§å®¹
        button.textContent = "é¡¯ç¤ºæ›´å¤š";
    }
}





function showingbtn() {
  showing();
  const button = document.getElementById("showbtn");
  button.style.display = "none";
  alert("æ•¸æ“šå·²é¡¯ç¤º");
}



let isLoggedIn = false;

function toggleLogin() {
  if (!isLoggedIn) {
    let username = prompt("è«‹è¼¸å…¥å¸³è™Ÿ:");
    let password = prompt("è«‹è¼¸å…¥å¯†ç¢¼:");
    if (username === "605" && password === "RC_Auto_Scheduling") {
      isLoggedIn = true;
      document.getElementById("loginBtn").textContent = "ç™»å‡º";
      document.getElementById("userStatus").classList.remove("hidden");
      document.getElementById("schedulebtn").classList.remove("hidden");
    } else {
      alert("ç™»å…¥å¤±æ•—");
    }
  } else {
    isLoggedIn = false;
    document.getElementById("loginBtn").textContent = "ç™»å…¥";
    document.getElementById("userStatus").classList.add("hidden");
    document.getElementById("schedulebtn").classList.add("hidden");
  }
}


async function scheduling() {
  
  alert("æ­£åœ¨ç‚ºæ‚¨å¾æ–°ç·¨æ’");
    if (!isLoggedIn) {
        alert("è«‹å…ˆç™»å…¥!");
        return;
    }
    else if (isLoggedIn) {
      const button = document.getElementById("schedulebtn");
      button.style.display = "none";
      
    }
    let message1 = "rangeall";
    let numindexx = "0";
    let numindexy = "0";
    let leavenum = "0";

    const apiUrl = `https://script.google.com/macros/s/AKfycbwZpsSjxlxsYkt5x2gOO3_59seqIENRJJeWyziQXCp0othCRydJ6emAfleLVGFeb4-S/exec?message1=${encodeURIComponent(message1)}&numindexx=${encodeURIComponent(numindexx)}&numindexy=${encodeURIComponent(numindexy)}&leavenum=${encodeURIComponent(leavenum)}`;

    try {
        const response = await fetch(apiUrl);
        const data = await response.json();
    } catch (error) {
        console.error("ç²å–æ•¸æ“šæ™‚å‡ºéŒ¯ï¼š", error);
    }
    showing();alert("æ•¸æ“šå·²æ›´æ–°");
    //const button1 = document.getElementById("showbtn");
    //button1.style.display = "block"; 
}

async function showing() {
  var name = document.getElementById("name");
  name.style.display = "block";
  var name1 = document.getElementById("name1");
  name1.style.display = "block";


    const sheetId = "1HWk8s__aXVkSLs4iShYuAdaiI231ze0-GDN52dcNN_A"; // ä½ çš„è©¦ç®—è¡¨ ID
    const apiKey = "AIzaSyCaPHKS9sBRNf0805GkgeMRgysyQPPuK0k"; // ä½ çš„ API é‡‘é‘°
    const range = "A1:E14"; // ä½ éœ€è¦çš„ç¯„åœ

    const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`;

    try {
        const response = await fetch(url);
        const data = await response.json();

        if (!data.values) {
            console.error("ç„¡æ³•å–å¾—æ•¸æ“š");
            return;
        }

        const values = data.values;

        // å–å¾— HTML è¡¨æ ¼å…ƒç´ 
        const leftTable = document.querySelector(".top-left table tbody");
        const rightTable1 = document.querySelector(".top-right #right-table1 tbody");
        const rightTable2 = document.querySelector(".top-right #right-table2 tbody");
        const bottomLeftTable = document.querySelector(".bottom #left-table tbody");
        const bottomRightTable1 = document.querySelector(".bottom #right-table1 tbody");
        const bottomRightTable2 = document.querySelector(".bottom #right-table2 tbody");

        // å¡«å…¥ å·¦ä¸Šè¡¨æ ¼ (A1~A5, B1~B5)
        for (let i = 0; i < 5; i++) {
            leftTable.rows[i].cells[0].textContent = values[i]?.[0] || "";
            leftTable.rows[i].cells[1].textContent = values[i]?.[1] || "";
        }

        // å¡«å…¥ å³ä¸Šè¡¨æ ¼ (D1~D2, E1~E2)
        for (let i = 0; i < 2; i++) {
            rightTable1.rows[i].cells[0].textContent = values[i]?.[3] || "";
            rightTable2.rows[i].cells[0].textContent = values[i]?.[4] || "";
        }

        // å¡«å…¥ å·¦ä¸‹è¡¨æ ¼ (A10~A14, B10~B14)
        for (let i = 9; i < 14; i++) {
            bottomLeftTable.rows[i - 9].cells[0].textContent = values[i]?.[0] || "";
            bottomLeftTable.rows[i - 9].cells[1].textContent = values[i]?.[1] || "";
        }

        // å¡«å…¥ å³ä¸‹è¡¨æ ¼ (D10~D11, E10~E11)
        for (let i = 9; i < 11; i++) {
            bottomRightTable1.rows[i - 9].cells[0].textContent = values[i]?.[3] || "";
            bottomRightTable2.rows[i - 9].cells[0].textContent = values[i]?.[4] || "";
        }

    } catch (error) {
        console.error("ç²å–è©¦ç®—è¡¨æ•¸æ“šæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š", error);
    }
    
    
}

</script>
<!--<script type='text/javascript' src='//pl25782514.effectiveratecpm.com/1a/23/c7/1a23c76e9439cf3ab46878a557705ebc.js'></script>
<p>æˆ‘æ˜¯å»£å‘Š(ä¸è¦é»æˆ‘)</p>
<script type="text/javascript">
	atOptions = {
		'key' : '06cb36d680391c873b7c96a3f5ba0f8a',
		'format' : 'iframe',
		'height' : 250,
		'width' : 300,
		'params' : {}
	};
</script>
<script type="text/javascript" src="//www.highperformanceformat.com/06cb36d680391c873b7c96a3f5ba0f8a/invoke.js"></script>
 -->
</body>
</html>
